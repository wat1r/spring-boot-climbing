# 系统设计面试指南

很多软件工程师在系统设计面试（SDI System Design Interview）中挣扎，主要是因为三个原因：
- SDI的非结构化性质，要求他们进行开放式设计的问题，但是没有标准答案
- 他们缺乏开发大型系统的经验
- 他们没有准备SDI

像编码面试一样，那些没有特意地为SDI做准备的应聘者，大多表现不佳，尤其是在谷歌、Facebook、亚马逊、微软等顶级公司。在上述的公司面试中，表现的低于平均水平的候选人，获得录用的机会很小。另一方面，一个好的表现总是带来更好的工作机会（更高的职位和薪水），因为可以显示候选人处理复杂系统的能力。
本课程，我们要一步一步低解决多种系统设计问题，首先，我们从下面的步骤开始：

## Step 1:需求澄清

就我们正在解决的问题的确切范围提出问题总是一个好主意。设计问题大多是开放式的，他们没有一个正确的答案，这就是为什么要在面试中澄清不清晰的点。花足够的时间定义系统的最终目标总是有更好的机会在面试中获得成功。还有，既然我们只有35-40分钟的时间来设计一个（假设）大型系统，我们应该弄清楚系统的哪些部分是我们要重点关注的：
让我们用一个设计类似于Twitter的服务的实际例子来扩展这一点。这里有一些问题在设计Twitter的时候需要被考虑到的：
- 我们服务的用户是否能够**发布**推特并**关注**其他人？
- 我们是否也应该设计来创建和显示用户的时间线？
- 推特会包含照片和视频吗？
- 我们是只关注后端还是也在开发前端？
- 用户是否能够搜索到推文？
- 我们是否需要展示热门话题？
- 是否会有推送新（或重要）推送通知？
所有这些问题都将决定我们的最终设计的定稿。
## Step2:系统接口定义

系统需要哪些API，这不仅能得到系统确定的预期，也将确保如果我们没有对需求理解发生偏差。一些例子
我们类似Twitter的服务：
```
postTweet(user_id, tweet_data, tweet_location, user_location, timestamp, …) 
generateTimeline(user_id, current_time, user_location, …) 
markTweetFavorite(user_id, tweet_id, timestamp, …)	
```

## Step3:粗略估计
估计我们要设计的系统的规模总是一个好主意。这也会有帮助稍后我们将重点讨论的**伸缩、分区、负载平衡和缓存**。
- 系统的预期规模（例如，新**推特**的数量、**推特**视图的数量，每秒的时间线生成数等等）？
- 我们需要多少存储空间？如果用户可以有推特中上传照片和视频，数量级又将变得不一样。
- 我们期望的网络带宽使用率是多少？这将是决定我们采取何种方案管理流量并平衡服务器之间的负载。
## Step4:定义数据模型
尽早定义数据模型将阐明数据将如何在系统的不同组件之间流动。进而将指导数据分区和管理。候选人应该能够识别系统的各种实体，它们将如何相互作用，以及数据管理的不同方面，如存储、传输、加密等。以下是我们类似Twitter服务的一些实体：
```
User: UserID, Name, Email, DoB, CreationData, LastLogin, etc.
Tweet: TweetID, Content, TweetLocation, NumberOfLikes, TimeStamp, etc.
UserFollowo: UserdID1, UserID2
FavoriteTweets: UserID, TweetID, TimeStamp
```
我们应该使用哪个数据库系统？像Cassandra这样的NoSQL最适合我们的需要，还是我们应该使用它
类似MySQL的解决方案？我们应该使用什么样的块存储来存储照片和视频？

## Step5:高阶设计

画一个方框图，5-6个方框代表我们系统的核心组件。我们应该确定从端到端解决实际问题所需的足够组件。
对于Twitter来说，在高阶设计上，在流量分发上，负载均衡可以帮助完成，需要多个应用服务器来承载所有的读/写操作。如果我们假设我们会如果有更多的读操作（与写操作相比），我们可以决定使用单独的服务器来处理这些场景。在后端，我们需要一个高效的数据库，可以存储所有的推文和可以支持大量读取。我们还需要一个用于存储照片和视频的分布式文件存储系统。

![image-20210305235836689](/Users/frankcooper/Library/Application Support/typora-user-images/image-20210305235836689.png)

## Step6:详细设计

深入研究两个或三个组件；面试官的反馈能指导系统的哪些部分需要进一步讨论。我们应该能够提出不同的方法，它们的优点和缺点，并解释为什么我们会选择一种方法而不是另一种方法。记住，没有单一的答案，唯一重要的是在考虑系统的设计的时候，需要考虑不同选项之间的权衡：
- 由于我们将存储大量数据，我们应该如何将数据划分，是否将其分发到多个数据库？我们是否应该尝试将一个用户的所有数据存储在同一个数据库？会引起什么问题？
- 我们将如何处理那些经常发推特或关注人数很多的热门用户？
- 由于用户的时间线将包含最新（和相关）的推文，我们是否应该尝试以一种最优化扫描最新的推特的方式存储数据？
- 我们应该在多大程度上以及在哪一层引入缓存来加快速度？
- 哪些组件需要更好的负载平衡？

## Step7:识别和解决瓶颈

尝试讨论尽可能多的瓶颈以及突破瓶颈的不同方法：
- 我们的系统中是否存在单点故障？我们在做什么来减缓它？
- 我们是否有足够的数据副本，以便一些服务器宕机的情况下仍能为用户提供服务？
- 类似地，我们是否有足够的副本，以避免出现一些故障不会导致系统完全停服？
- 我们如何监控服务的整体运行情况？组件故障或服务降级时有告警吗？

## 总结

总之，面试过程中的准备和组织是面试系统设计成功的关键。上述步骤应指导您保持正轨，涵盖所有设计一个系统时要考虑的不同方面。
让我们应用上述准则来设计SDIs中要求的几个系统。